<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Web Sprint 2 Challenge</title>
    <style>
      .widget {
        padding: 0 0 0.5rem 0.65rem;
        margin-bottom: 0.5rem;
        border: 1px solid black;
        border-radius: 0.5rem;
      }

      .widget p {
        font-size: 0.75rem;
        font-style: italic;
      }

      .row > div {
        display: inline-block;
        background-color: lightgrey;
        border: 1px solid grey;
        width: 2rem;
        height: 2rem;
        cursor: pointer;
      }

      #outcome {
        font-size: 3rem;
      }
    </style>
  </head>

  <body>
    <h1>Web Sprint 2 Challenge</h1>
    <p>
      ‚ùó See the last script tag for instructions on completing your Challenge
    </p>
    <!-- widgets start -->
    <section class="widget">
      <p>Click on a square! (this widget uses the mineSweeper function)</p>
      <div class="row" id="row1">
        <div></div>
        <div></div>
        <div></div>
      </div>
      <div class="row" id="row2">
        <div></div>
        <div></div>
        <div></div>
      </div>
      <div class="row" id="row3">
        <div></div>
        <div></div>
        <div></div>
      </div>
      <span id="outcome"></span>
    </section>
    <form class="widget">
      <p>
        Type a ten-digit number! (this widget uses the normalizePhoneNumber
        function)
      </p>
      <form>
        <label for="phoneNumInput">Phone Number:</label>
      <input type="text" id="phoneNumInput" maxlength="10" />
      <span id="normalized"></span>
    </form>
    <!-- widgets end -->

    <!-- The first script tag loads a library called lodash that helps with testing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
    <script id="challenge">
      // In CHALLENGES 1-6 you will write JavaScript functions

      // ‚ùó Functions are scaffolded for you, but are missing their parameters and bodies
      // ‚ùó Do not rename the functions provided, and do not create any other script tags
      // ‚ùó Do not modify the location of the two script tags in this document
      // ‚ùó Debug properly using the Console

      // üëâ CHALLENGE 1
      function profileActivation(profile, reason) {
        // Check if profile is an object and if it has an active property
        if (typeof profile === 'object' && profile !== null) {
          if (!profile.hasOwnProperty('active')) {
            return "impossible to ascertain status";
          }

          // Handle active profiles
          if (profile.active) {
            if (reason !== undefined) {
              // Deactivate if active and a reason is provided
              return { ...profile, active: false, reason };
            } else if (profile.hasOwnProperty('reason')) {
              return "confirm status manually";
            }
          } else {
            // For inactive profiles without a reason, return "confirm status manually"
            if (reason === undefined && !profile.hasOwnProperty('reason')) {
              return "confirm status manually";
            } else {
              // Activate if inactive and a reason is provided or exists as a property
              return { active: true };
            }
          }
        } else {
          // Fallback in case profile is not an object
          return "invalid profile input";
        }
      }
      
      // üëâ CHALLENGE 2
      function mineSweeper(grid, x, y) {
        // Adjust coordinates for zero-based indexing
        x -= 1;
        y -= 1;

        // Check if the coordinates are within the grid bounds
        if (x < 0 || y < 0 || y >= grid.length || x >= grid[y].length) {
          return "invalid coordinates";
        }

        // Check the color at the specified coordinates and return the corresponding message
        const color = grid[y][x];
        if (color === "üü•") {
          return "üü• üíÄ";
        } else if (color === "üü¶") {
          return "üü¶ ü•≥";
        }

        // Fallback for any unexpected cases
        return "unexpected grid value";
      }

      // üëâ CHALLENGE 3
      function booleanize(inputObj) {
        // Check for property name length
        for (let key in inputObj) {
          if (key.length > 9) {
            return "shorten all prop names to 9 chars or less";
          }
        }

        // Constructing a new object
        const transformedObj = {};
        for (let key in inputObj) {
          if (inputObj[key] === 0) {
            transformedObj[key] = false;
          } else if (inputObj[key] === 1) {
            transformedObj[key] = true;
          } else if (inputObj[key] !== null) {
            transformedObj[key] = inputObj[key];
          }
        }

        return transformedObj;
      };

      // üëâ CHALLENGE 4
      function scrub(text, forbiddenWords) {
        // Split the text into words
        let words = text.split(' ');

        // Scrubbing forbidden words
        words = words.map(word => {
          for (let forbiddenWord of forbiddenWords) {
            if (word.toLowerCase() === forbiddenWord.toLowerCase()) {
              return 'x'.repeat(word.length);
            }
          }
          return word;
        });

        // Rejoin the words into a single string
        return words.join(' ');
      }

      // üëâ CHALLENGE 5
      function normalizePhoneNumber(number) {
        // Check for correct length
        if (number.length !== 10) {
          return "type a 10-digit number";
        }

        // Check if all characters are digits
        if (!/^\d+$/.test(number)) {
          return "invalid phone number";
        }

        // Split the number into parts for formatting
        let areaCode = number.substring(0, 3);
        let mainNumber = number.substring(3);

        // Format and return the number
        return `(${areaCode}) ${mainNumber.substring(0, 3)}-${mainNumber.substring(3)}`;
      }


      // üëâ CHALLENGE 6 (bonus, NOT graded)
      function diceRolls() {
          let totalRolls = 0;
          let consecutiveSixes = 0;

          while (true) {
            let roll = Math.floor(Math.random() * 6) + 1;
            totalRolls++;

            if (roll === 6) {
              consecutiveSixes++;
              if (consecutiveSixes === 3) {
                break; // Break out of the loop when three sixes in a row are rolled
              }
            } else {
              consecutiveSixes = 0; // Reset consecutive sixes counter if roll is not a six
            }
          }

          return totalRolls;
        }

      // üß™ TESTS, do not make any changes below this line ===================
      // üß™ TESTS, do not make any changes below this line ===================
      // üß™ TESTS, do not make any changes below this line ===================
      globalThis.challengeVersion = 1;
      globalThis.profileActivation = profileActivation;
      globalThis.mineSweeper = mineSweeper;
      globalThis.booleanize = booleanize;
      globalThis.scrub = scrub;
      globalThis.normalizePhoneNumber = normalizePhoneNumber;

      try {
        runTests("CHALLENGE 1 - profileActivation", profileActivation, [
          [[{}], "impossible to ascertain status"],
          [[{ active: true, reason: "" }], "confirm status manually"],
          [[{ active: true, reason: "because" }], "confirm status manually"],
          [[{ active: false }], "confirm status manually"],
          [[{ active: true }, "because"], { active: false, reason: "because" }],
          [[{ active: false, reason: "because" }], { active: true }],
        ]);
        runTests("CHALLENGE 2 - mineSweeper", mineSweeper, [
          [
            [
              [
                ["üü•", "üü¶", "üü•"],
                ["üü¶", "üü•", "üü•"],
                ["üü•", "üü¶", "üü¶"],
              ],
              0,
              4,
            ],
            "invalid coordinates",
          ],
          [
            [
              [
                ["üü•", "üü¶", "üü•"],
                ["üü¶", "üü•", "üü•"],
                ["üü•", "üü¶", "üü¶"],
              ],
              0,
              1,
            ],
            "invalid coordinates",
          ],
          [
            [
              [
                ["üü•", "üü¶", "üü•"],
                ["üü¶", "üü•", "üü•"],
                ["üü•", "üü¶", "üü¶"],
              ],
              1,
              4,
            ],
            "invalid coordinates",
          ],
          [
            [
              [
                ["üü¶", "üü¶", "üü•"],
                ["üü¶", "üü¶", "üü¶"],
                ["üü¶", "üü¶", "üü•"],
              ],
              1,
              1,
            ],
            "üü¶ ü•≥",
          ],
          [
            [
              [
                ["üü¶", "üü•", "üü¶"],
                ["üü¶", "üü¶", "üü¶"],
                ["üü•", "üü¶", "üü•"],
              ],
              2,
              1,
            ],
            "üü• üíÄ",
          ],
          [
            [
              [
                ["üü•", "üü¶", "üü•"],
                ["üü•", "üü•", "üü¶"],
                ["üü•", "üü•", "üü¶"],
              ],
              3,
              1,
            ],
            "üü• üíÄ",
          ],
          [
            [
              [
                ["üü•", "üü¶", "üü¶"],
                ["üü•", "üü¶", "üü•"],
                ["üü¶", "üü¶", "üü¶"],
              ],
              1,
              2,
            ],
            "üü• üíÄ",
          ],
          [
            [
              [
                ["üü•", "üü•", "üü•"],
                ["üü•", "üü¶", "üü•"],
                ["üü¶", "üü•", "üü¶"],
              ],
              2,
              2,
            ],
            "üü¶ ü•≥",
          ],
          [
            [
              [
                ["üü•", "üü¶", "üü¶"],
                ["üü¶", "üü•", "üü•"],
                ["üü•", "üü•", "üü¶"],
              ],
              3,
              2,
            ],
            "üü• üíÄ",
          ],
          [
            [
              [
                ["üü•", "üü•", "üü•"],
                ["üü¶", "üü¶", "üü•"],
                ["üü•", "üü•", "üü¶"],
              ],
              1,
              3,
            ],
            "üü• üíÄ",
          ],
          [
            [
              [
                ["üü•", "üü¶", "üü•"],
                ["üü•", "üü•", "üü•"],
                ["üü•", "üü¶", "üü•"],
              ],
              2,
              3,
            ],
            "üü¶ ü•≥",
          ],
          [
            [
              [
                ["üü•", "üü•", "üü•"],
                ["üü¶", "üü•", "üü•"],
                ["üü•", "üü•", "üü¶"],
              ],
              3,
              3,
            ],
            "üü¶ ü•≥",
          ],
          [
            [
              [
                ["üü•", "üü¶", "üü¶"],
                ["üü•", "üü•", "üü¶"],
                ["üü•", "üü•", "üü•"],
              ],
              1,
              1,
            ],
            "üü• üíÄ",
          ],
          [
            [
              [
                ["üü•", "üü¶", "üü¶"],
                ["üü•", "üü•", "üü¶"],
                ["üü•", "üü•", "üü•"],
              ],
              2,
              2,
            ],
            "üü• üíÄ",
          ],
          [
            [
              [
                ["üü•", "üü¶", "üü¶"],
                ["üü•", "üü•", "üü¶"],
                ["üü•", "üü•", "üü•"],
              ],
              3,
              3,
            ],
            "üü• üíÄ",
          ],
        ]);
        runTests("CHALLENGE 3 - booleanize", booleanize, [
          [[{ bad1: null }], {}],
          [[{ bad1: null, bad2: null }], {}],
          [[{ "0123456789": 1 }], "shorten all prop names to 9 chars or less"],
          [[{ a: 1, b: 1 }], { a: true, b: true }],
          [[{ a: 0, b: 0 }], { a: false, b: false }],
          [
            [{ a: 1, b: 0, c: null, d: "Lady Gaga" }],
            { a: true, b: false, d: "Lady Gaga" },
          ],
        ]);
        runTests("CHALLENGE 4 - scrub", scrub, [
          [
            ["out of the silent planet", ["of", "silent"]],
            "out xx the xxxxxx planet",
          ],
          [
            ["out of the silent planet", ["of", "planet"]],
            "out xx the silent xxxxxx",
          ],
          [
            ["the ghost of the navigator", ["the"]],
            "xxx ghost of xxx navigator",
          ],
          [["lost somewhere in time", []], "lost somewhere in time"],
          [["aces high", ["high", "aces", "hearts"]], "xxxx xxxx"],
          [["", ["high", "aces"]], ""],
        ]);
        runTests("CHALLENGE 5 - normalizePhoneNumber", normalizePhoneNumber, [
          [["1234567890"], "(123) 456-7890"],
          [["1111111111"], "(111) 111-1111"],
          [["9876543210"], "(987) 654-3210"],
          [[""], "type a 10-digit number"],
          [["x"], "type a 10-digit number"],
          [["987654321"], "type a 10-digit number"],
          [["98765432100"], "type a 10-digit number"],
          [["987654321x"], "invalid phone number"],
          [["x876543210"], "invalid phone number"],
          [["98765x3210"], "invalid phone number"],
        ]);
        console.log("\nCHALLENGE 6 does not have auto tests");
        function runTests(testName, func, tests) {
          let results = [];
          tests.forEach((test) => {
            const originalArgsList = _.cloneDeep(test[0]);
            const argsList = test[0];
            const expected = test[1];
            const actual = func.apply(null, argsList);
            results.push([argsList, expected, actual, originalArgsList]);
          });
          console.log("\n" + testName);
          if (results.every((result) => _.isEqual(result[1], result[2])))
            console.log("\t‚úÖ All tests pass");
          else if (results.every((result) => !_.isEqual(result[1], result[2])))
            console.log("\t‚ùå All tests fail");
          else
            results.forEach((result, idx) => {
              if (_.isEqual(result[1], result[2]))
                console.log(`\t‚úÖ Test ${idx + 1} passes`);
              else
                console.log(`\t‚ùå Test ${idx + 1} fails:
        ${func.name}(${result[3].map(JSON.stringify)})
        üëâ should return ${JSON.stringify(result[1])}
        üëâ but returns ${JSON.stringify(result[2])}`);
            });
        }
        const gridElems = [
          Array.from(row1.children),
          Array.from(row2.children),
          Array.from(row3.children),
        ];
        const squares = ["üü•", "üü¶"];
        let grid = [[], [], []];
        gridElems.forEach((row, idxRow) => {
          row.forEach((square, idxSquare) => {
            const emoji = squares[Math.floor(Math.random() * 2)];
            grid[idxRow].push(emoji);
            if (emoji === squares[0]) square.style.backgroundColor = "#ffecec";
            else square.style.backgroundColor = "#f2f2ff";
            square.onclick = () => {
              const x = idxSquare + 1;
              const y = idxRow + 1;
              console.log(`\nYou clicked coordinates [${x}, ${y}]`);
              outcome.textContent = mineSweeper(grid, x, y);
            };
          });
        });
        phoneNumInput.oninput = (evt) => {
          normalized.textContent = normalizePhoneNumber(evt.target.value);
        };
      } catch (err) {
        console.error(err.stack);
      }
    </script>
  </body>
</html>
